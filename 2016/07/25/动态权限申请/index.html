<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="小爱小世界" />



<meta name="description" content="基本介绍我的简书: Android6.0动态权限申请步骤以及需要注意的一些坑
因为工作需要，简单研究了一下Android6.0权限申请，在Google提供的sample的基础上，写了一个简单的demo。算是自己的笔记吧，可能会比较混乱，主要是方便以后查看。后期有别的问题，随时更新~

本demo github下载地址！！！  
Google提供的demo的下载地址  
6.0权限的基本知识，以下是">
<meta property="og:type" content="article">
<meta property="og:title" content="Android6.0动态权限申请步骤以及需要注意的一些坑">
<meta property="og:url" content="http://lovexiaoai.cn/2016/07/25/动态权限申请/index.html">
<meta property="og:site_name" content="小爱">
<meta property="og:description" content="基本介绍我的简书: Android6.0动态权限申请步骤以及需要注意的一些坑
因为工作需要，简单研究了一下Android6.0权限申请，在Google提供的sample的基础上，写了一个简单的demo。算是自己的笔记吧，可能会比较混乱，主要是方便以后查看。后期有别的问题，随时更新~

本demo github下载地址！！！  
Google提供的demo的下载地址  
6.0权限的基本知识，以下是">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1975505-8797c58a6bc35b84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1975505-ec1877b089a98891.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1975505-c8bc0d8e5c95cead.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1975505-010c521fdfc20714.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2016-09-09T08:02:11.768Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android6.0动态权限申请步骤以及需要注意的一些坑">
<meta name="twitter:description" content="基本介绍我的简书: Android6.0动态权限申请步骤以及需要注意的一些坑
因为工作需要，简单研究了一下Android6.0权限申请，在Google提供的sample的基础上，写了一个简单的demo。算是自己的笔记吧，可能会比较混乱，主要是方便以后查看。后期有别的问题，随时更新~

本demo github下载地址！！！  
Google提供的demo的下载地址  
6.0权限的基本知识，以下是">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1975505-8797c58a6bc35b84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="小爱" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Android6.0动态权限申请步骤以及需要注意的一些坑 | 小爱</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?4bce5575ff156966acd63607cdef3af2";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">小爱小世界</a></h1>
        </hgroup>

        
        <p class="header-subtitle">开心就好~</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" href="http://weibo.com/3301284230/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/qianxiaoai" title="GitHub"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/users/784e25a9d175/latest_articles" title="简书"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-M/">Android M</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-N/">Android N</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FileProvider/">FileProvider</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java基础/">java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/手工/">手工</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/权限/">权限</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">简简单单，开心就好~</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">小爱小世界</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">小爱小世界</a></h1>
            </hgroup>
            
            <p class="header-subtitle">开心就好~</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/3301284230/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/qianxiaoai" title="GitHub"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/users/784e25a9d175/latest_articles" title="简书"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-动态权限申请" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/25/动态权限申请/" class="article-date">
      <time datetime="2016-07-25T06:51:12.322Z" itemprop="datePublished">2016-07-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android6.0动态权限申请步骤以及需要注意的一些坑
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-M/">Android M</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/权限/">权限</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><a href="http://www.jianshu.com/p/a51593817825" target="_blank" rel="external">我的简书: Android6.0动态权限申请步骤以及需要注意的一些坑</a></p>
<p>因为工作需要，简单研究了一下Android6.0权限申请，在Google提供的sample的基础上，写了一个简单的demo。算是自己的笔记吧，可能会比较混乱，主要是方便以后查看。后期有别的问题，随时更新~</p>
<ul>
<li><a href="https://github.com/qianxiaoai/RuntimePermissionsDemo/tree/dev" target="_blank" rel="external">本demo github下载地址！！！</a>  </li>
<li><a href="https://github.com/googlesamples/android-RuntimePermissions" target="_blank" rel="external">Google提供的demo的下载地址</a>  </li>
<li>6.0权限的基本知识，以下是需要单独申请的权限，共分为9组，每组只要有一个权限申请成功了，就默认整组权限都可以使用了。</li>
</ul>
<a id="more"></a>
<pre><code>group:android.permission-group.CONTACTS
  permission:android.permission.WRITE_CONTACTS
  permission:android.permission.GET_ACCOUNTS    
  permission:android.permission.READ_CONTACTS

group:android.permission-group.PHONE
  permission:android.permission.READ_CALL_LOG
  permission:android.permission.READ_PHONE_STATE 
  permission:android.permission.CALL_PHONE
  permission:android.permission.WRITE_CALL_LOG
  permission:android.permission.USE_SIP
  permission:android.permission.PROCESS_OUTGOING_CALLS
  permission:com.android.voicemail.permission.ADD_VOICEMAIL

group:android.permission-group.CALENDAR
  permission:android.permission.READ_CALENDAR
  permission:android.permission.WRITE_CALENDAR

group:android.permission-group.CAMERA
  permission:android.permission.CAMERA

group:android.permission-group.SENSORS
  permission:android.permission.BODY_SENSORS

group:android.permission-group.LOCATION
  permission:android.permission.ACCESS_FINE_LOCATION
  permission:android.permission.ACCESS_COARSE_LOCATION

group:android.permission-group.STORAGE
  permission:android.permission.READ_EXTERNAL_STORAGE
  permission:android.permission.WRITE_EXTERNAL_STORAGE

group:android.permission-group.MICROPHONE
  permission:android.permission.RECORD_AUDIO

group:android.permission-group.SMS
  permission:android.permission.READ_SMS
  permission:android.permission.RECEIVE_WAP_PUSH
  permission:android.permission.RECEIVE_MMS
  permission:android.permission.RECEIVE_SMS
  permission:android.permission.SEND_SMS
  permission:android.permission.READ_CELL_BROADCASTS
</code></pre><ul>
<li><p>以下是普通权限，只需要在AndroidManifest.xml中申请即可。</p>
<pre><code>android.permission.ACCESS_LOCATION_EXTRA_COMMANDS
android.permission.ACCESS_NETWORK_STATE
android.permission.ACCESS_NOTIFICATION_POLICY
android.permission.ACCESS_WIFI_STATE
android.permission.ACCESS_WIMAX_STATE
android.permission.BLUETOOTH
android.permission.BLUETOOTH_ADMIN
android.permission.BROADCAST_STICKY
android.permission.CHANGE_NETWORK_STATE
android.permission.CHANGE_WIFI_MULTICAST_STATE
android.permission.CHANGE_WIFI_STATE
android.permission.CHANGE_WIMAX_STATE
android.permission.DISABLE_KEYGUARD
android.permission.EXPAND_STATUS_BAR
android.permission.FLASHLIGHT
android.permission.GET_ACCOUNTS
android.permission.GET_PACKAGE_SIZE
android.permission.INTERNET
android.permission.KILL_BACKGROUND_PROCESSES
android.permission.MODIFY_AUDIO_SETTINGS
android.permission.NFC
android.permission.READ_SYNC_SETTINGS
android.permission.READ_SYNC_STATS
android.permission.RECEIVE_BOOT_COMPLETED
android.permission.REORDER_TASKS
android.permission.REQUEST_INSTALL_PACKAGES
android.permission.SET_TIME_ZONE
android.permission.SET_WALLPAPER
android.permission.SET_WALLPAPER_HINTS
android.permission.SUBSCRIBED_FEEDS_READ
android.permission.TRANSMIT_IR
android.permission.USE_FINGERPRINT
android.permission.VIBRATE
android.permission.WAKE_LOCK
android.permission.WRITE_SYNC_SETTINGS
com.android.alarm.permission.SET_ALARM
com.android.launcher.permission.INSTALL_SHORTCUT
com.android.launcher.permission.UNINSTALL_SHORTCUT
</code></pre></li>
</ul>
<h2 id="申请步骤"><a href="#申请步骤" class="headerlink" title="申请步骤"></a>申请步骤</h2><ul>
<li><ol>
<li>将targetSdkVersion设置为23，注意，如果你将targetSdkVersion设置为&gt;=23，则必须按照Android谷歌的要求，动态的申请权限，如果你暂时不打算支持动态权限申请，则targetSdkVersion最大只能设置为22.</li>
</ol>
</li>
<li><p>2  在AndroidManifest.xml中申请你需要的权限，包括普通权限和需要申请的特殊权限。</p>
</li>
<li><p>3.开始申请权限，此处分为3部。</p>
<ul>
<li><p>（1）检查是否由此权限checkSelfPermission()，如果已经开启，则直接做你想做的。</p>
</li>
<li><p>（2）如果未开启，则判断是否需要向用户解释为何申请权限shouldShowRequestPermissionRationale。</p>
</li>
<li>（3）如果需要（即返回true），则可以弹出对话框提示用户申请权限原因，用户确认后申请权限requestPermissions()，如果不需要（即返回false），则直接申请权限requestPermissions()。<br>（这里是一部门代码，底部有比较完善的代码，整个demo可以在github中下载）。</li>
</ul>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1975505-8797c58a6bc35b84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="单个权限申请.png"></p>
<pre><code>     /**
         * Requests permission.
         *
         * @param activity
         * @param requestCode request code, e.g. if you need request CAMERA permission,parameters is PermissionUtils.CODE_CAMERA
         */
        public static void requestPermission(final Activity activity, final int requestCode, PermissionGrant permissionGrant) {
            if (activity == null) {
                return;
            }

            Log.i(TAG, &quot;requestPermission requestCode:&quot; + requestCode);
            if (requestCode &lt; 0 || requestCode &gt;= requestPermissions.length) {
                Log.w(TAG, &quot;requestPermission illegal requestCode:&quot; + requestCode);
                return;
            }

            final String requestPermission = requestPermissions[requestCode];

            //如果是6.0以下的手机，ActivityCompat.checkSelfPermission()会始终等于PERMISSION_GRANTED，
        // 但是，如果用户关闭了你申请的权限(如下图，在安装的时候，将一些权限关闭了)，ActivityCompat.checkSelfPermission()则可能会导致程序崩溃(java.lang.RuntimeException: Unknown exception code: 1 msg null)，
        // 你可以使用try{}catch(){},处理异常，也可以判断系统版本，低于23就不申请权限，直接做你想做的。permissionGrant.onPermissionGranted(requestCode);
//        if (Build.VERSION.SDK_INT &lt; 23) {
//            permissionGrant.onPermissionGranted(requestCode);
//            return;
//        }

            int checkSelfPermission;
            try {
                checkSelfPermission = ActivityCompat.checkSelfPermission(activity, requestPermission);
            } catch (RuntimeException e) {
                Toast.makeText(activity, &quot;please open this permission&quot;, Toast.LENGTH_SHORT)
                        .show();
                Log.e(TAG, &quot;RuntimeException:&quot; + e.getMessage());
                return;
            }

            if (checkSelfPermission != PackageManager.PERMISSION_GRANTED) {
                Log.i(TAG, &quot;ActivityCompat.checkSelfPermission != PackageManager.PERMISSION_GRANTED&quot;);


                if (ActivityCompat.shouldShowRequestPermissionRationale(activity, requestPermission)) {
                    Log.i(TAG, &quot;requestPermission shouldShowRequestPermissionRationale&quot;);
                    shouldShowRationale(activity, requestCode, requestPermission);

                } else {
                    Log.d(TAG, &quot;requestCameraPermission else&quot;);
                    ActivityCompat.requestPermissions(activity, new String[]{requestPermission}, requestCode);
                }

            } else {
                Log.d(TAG, &quot;ActivityCompat.checkSelfPermission ==== PackageManager.PERMISSION_GRANTED&quot;);
                Toast.makeText(activity, &quot;opened:&quot; + requestPermissions[requestCode], Toast.LENGTH_SHORT).show();
//得到权限的时候，就可以在回调里面做你想做的事情了
                permissionGrant.onPermissionGranted(requestCode);
            }
        }
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/1975505-ec1877b089a98891.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.0以下系统的应用程序安装界面.png"></p>
<h2 id="备注！！！"><a href="#备注！！！" class="headerlink" title="备注！！！"></a>备注！！！</h2><p> （1）checkSelfPermission：检查是否拥有这个权限<br> （2）requestPermissions：请求权限，一般会弹出一个系统对话框，询问用户是否开启这个权限。<br> （3）shouldShowRequestPermissionRationale：Android原生系统中，如果第二次弹出权限申请的对话框，会出现“以后不再弹出”的提示框，如果用户勾选了，你再申请权限，则shouldShowRequestPermissionRationale返回true，意思是说要给用户一个 解释，告诉用户为什么要这个权限。然而，在实际开发中，需要注意的是，很多手机对原生系统做了修改，比如小米，小米4的6.0的shouldShowRequestPermissionRationale 就一直返回false，而且在申请权限时，如果用户选择了拒绝，则不会再弹出对话框了。。。。 所以说这个地方有坑，我的解决方法是，在回调里面处理，如果用户拒绝了这个权限，则打开本应用信息界面，由用户自己手动开启这个权限。<br>（4）每个应用都有自己的权限管理界面，里面有本应用申请的权限以及各种状态，即使用户已经同意了你申请的权限，他也随时可以关闭</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1975505-c8bc0d8e5c95cead.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="权限管理界面.png"></p>
<h2 id="一次申请多个权限"><a href="#一次申请多个权限" class="headerlink" title="一次申请多个权限"></a>一次申请多个权限</h2><p>其实和申请一个权限是一样的，只是requestPermissions(final @NonNull Activity activity,<br>            final @NonNull String[] permissions, final int requestCode),里面的permissions给的参数多些而已。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1975505-010c521fdfc20714.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="申请多个权限.png"></p>
<pre><code>/**
    * 一次申请多个权限
    */
   public static void requestMultiPermissions(final Activity activity, PermissionGrant grant) {

       final List&lt;String&gt; permissionsList = getNoGrantedPermission(activity, false);
       final List&lt;String&gt; shouldRationalePermissionsList = getNoGrantedPermission(activity, true);

       //TODO checkSelfPermission
       if (permissionsList == null || shouldRationalePermissionsList == null) {
           return;
       }
       Log.d(TAG, &quot;requestMultiPermissions permissionsList:&quot; + permissionsList.size() + &quot;,shouldRationalePermissionsList:&quot; + shouldRationalePermissionsList.size());

       if (permissionsList.size() &gt; 0) {
           ActivityCompat.requestPermissions(activity, permissionsList.toArray(new String[permissionsList.size()]),
                   CODE_MULTI_PERMISSION);
           Log.d(TAG, &quot;showMessageOKCancel requestPermissions&quot;);

       } else if (shouldRationalePermissionsList.size() &gt; 0) {
           showMessageOKCancel(activity, &quot;should open those permission&quot;,
                   new DialogInterface.OnClickListener() {
                       @Override
                       public void onClick(DialogInterface dialog, int which) {
                           ActivityCompat.requestPermissions(activity, shouldRationalePermissionsList.toArray(new String[shouldRationalePermissionsList.size()]),
                                   CODE_MULTI_PERMISSION);
                           Log.d(TAG, &quot;showMessageOKCancel requestPermissions&quot;);
                       }
                   });
       } else {
           grant.onPermissionGranted(CODE_MULTI_PERMISSION);
       }

   }
</code></pre><ul>
<li><p>关于权限请求结果的回调。Activity实现ActivityCompat.OnRequestPermissionsResultCallback接口，重写onRequestPermissionsResult方法。    </p>
<pre><code>@Override
 public void onRequestPermissionsResult(final int requestCode, @NonNull String[] permissions,
                                        @NonNull int[] grantResults) {
     PermissionUtils.requestPermissionsResult(this, requestCode, permissions, grantResults, mPermissionGrant);

 }
</code></pre></li>
</ul>
<h2 id="整个申请权限工具类代码"><a href="#整个申请权限工具类代码" class="headerlink" title="整个申请权限工具类代码"></a>整个申请权限工具类代码</h2><pre><code>package com.example.android.system.runtimepermissions;

import android.Manifest;
import android.app.Activity;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.provider.Settings;
import android.support.annotation.NonNull;
import android.support.v4.app.ActivityCompat;
import android.support.v7.app.AlertDialog;
import android.util.Log;
import android.widget.Toast;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Created by qianxiaoai on 2016/7/7.
 */
public class PermissionUtils {

    private static final String TAG = PermissionUtils.class.getSimpleName();
    public static final int CODE_RECORD_AUDIO = 0;
    public static final int CODE_GET_ACCOUNTS = 1;
    public static final int CODE_READ_PHONE_STATE = 2;
    public static final int CODE_CALL_PHONE = 3;
    public static final int CODE_CAMERA = 4;
    public static final int CODE_ACCESS_FINE_LOCATION = 5;
    public static final int CODE_ACCESS_COARSE_LOCATION = 6;
    public static final int CODE_READ_EXTERNAL_STORAGE = 7;
    public static final int CODE_WRITE_EXTERNAL_STORAGE = 8;
    public static final int CODE_MULTI_PERMISSION = 100;

    public static final String PERMISSION_RECORD_AUDIO = Manifest.permission.RECORD_AUDIO;
    public static final String PERMISSION_GET_ACCOUNTS = Manifest.permission.GET_ACCOUNTS;
    public static final String PERMISSION_READ_PHONE_STATE = Manifest.permission.READ_PHONE_STATE;
    public static final String PERMISSION_CALL_PHONE = Manifest.permission.CALL_PHONE;
    public static final String PERMISSION_CAMERA = Manifest.permission.CAMERA;
    public static final String PERMISSION_ACCESS_FINE_LOCATION = Manifest.permission.ACCESS_FINE_LOCATION;
    public static final String PERMISSION_ACCESS_COARSE_LOCATION = Manifest.permission.ACCESS_COARSE_LOCATION;
    public static final String PERMISSION_READ_EXTERNAL_STORAGE = Manifest.permission.READ_EXTERNAL_STORAGE;
    public static final String PERMISSION_WRITE_EXTERNAL_STORAGE = Manifest.permission.WRITE_EXTERNAL_STORAGE;

    private static final String[] requestPermissions = {
            PERMISSION_RECORD_AUDIO,
            PERMISSION_GET_ACCOUNTS,
            PERMISSION_READ_PHONE_STATE,
            PERMISSION_CALL_PHONE,
            PERMISSION_CAMERA,
            PERMISSION_ACCESS_FINE_LOCATION,
            PERMISSION_ACCESS_COARSE_LOCATION,
            PERMISSION_READ_EXTERNAL_STORAGE,
            PERMISSION_WRITE_EXTERNAL_STORAGE
    };

    interface PermissionGrant {
        void onPermissionGranted(int requestCode);
    }

    /**
     * Requests permission.
     *
     * @param activity
     * @param requestCode request code, e.g. if you need request CAMERA permission,parameters is PermissionUtils.CODE_CAMERA
     */
    public static void requestPermission(final Activity activity, final int requestCode, PermissionGrant permissionGrant) {
        if (activity == null) {
            return;
        }

        Log.i(TAG, &quot;requestPermission requestCode:&quot; + requestCode);
        if (requestCode &lt; 0 || requestCode &gt;= requestPermissions.length) {
            Log.w(TAG, &quot;requestPermission illegal requestCode:&quot; + requestCode);
            return;
        }

        final String requestPermission = requestPermissions[requestCode];

        //如果是6.0以下的手机，ActivityCompat.checkSelfPermission()会始终等于PERMISSION_GRANTED，
        // 但是，如果用户关闭了你申请的权限，ActivityCompat.checkSelfPermission(),会导致程序崩溃(java.lang.RuntimeException: Unknown exception code: 1 msg null)，
        // 你可以使用try{}catch(){},处理异常，也可以在这个地方，低于23就什么都不做，
        // 个人建议try{}catch(){}单独处理，提示用户开启权限。
//        if (Build.VERSION.SDK_INT &lt; 23) {
//            return;
//        }

        int checkSelfPermission;
        try {
            checkSelfPermission = ActivityCompat.checkSelfPermission(activity, requestPermission);
        } catch (RuntimeException e) {
            Toast.makeText(activity, &quot;please open this permission&quot;, Toast.LENGTH_SHORT)
                    .show();
            Log.e(TAG, &quot;RuntimeException:&quot; + e.getMessage());
            return;
        }

        if (checkSelfPermission != PackageManager.PERMISSION_GRANTED) {
            Log.i(TAG, &quot;ActivityCompat.checkSelfPermission != PackageManager.PERMISSION_GRANTED&quot;);


            if (ActivityCompat.shouldShowRequestPermissionRationale(activity, requestPermission)) {
                Log.i(TAG, &quot;requestPermission shouldShowRequestPermissionRationale&quot;);
                shouldShowRationale(activity, requestCode, requestPermission);

            } else {
                Log.d(TAG, &quot;requestCameraPermission else&quot;);
                ActivityCompat.requestPermissions(activity, new String[]{requestPermission}, requestCode);
            }

        } else {
            Log.d(TAG, &quot;ActivityCompat.checkSelfPermission ==== PackageManager.PERMISSION_GRANTED&quot;);
            Toast.makeText(activity, &quot;opened:&quot; + requestPermissions[requestCode], Toast.LENGTH_SHORT).show();
            permissionGrant.onPermissionGranted(requestCode);
        }
    }

    private static void requestMultiResult(Activity activity, String[] permissions, int[] grantResults, PermissionGrant permissionGrant) {

        if (activity == null) {
            return;
        }

        //TODO
        Log.d(TAG, &quot;onRequestPermissionsResult permissions length:&quot; + permissions.length);
        Map&lt;String, Integer&gt; perms = new HashMap&lt;&gt;();

        ArrayList&lt;String&gt; notGranted = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; permissions.length; i++) {
            Log.d(TAG, &quot;permissions: [i]:&quot; + i + &quot;, permissions[i]&quot; + permissions[i] + &quot;,grantResults[i]:&quot; + grantResults[i]);
            perms.put(permissions[i], grantResults[i]);
            if (grantResults[i] != PackageManager.PERMISSION_GRANTED) {
                notGranted.add(permissions[i]);
            }
        }

        if (notGranted.size() == 0) {
            Toast.makeText(activity, &quot;all permission success&quot; + notGranted, Toast.LENGTH_SHORT)
                    .show();
            permissionGrant.onPermissionGranted(CODE_MULTI_PERMISSION);
        } else {
            openSettingActivity(activity, &quot;those permission need granted!&quot;);
        }

    }


    /**
     * 一次申请多个权限
     */
    public static void requestMultiPermissions(final Activity activity, PermissionGrant grant) {

        final List&lt;String&gt; permissionsList = getNoGrantedPermission(activity, false);
        final List&lt;String&gt; shouldRationalePermissionsList = getNoGrantedPermission(activity, true);

        //TODO checkSelfPermission
        if (permissionsList == null || shouldRationalePermissionsList == null) {
            return;
        }
        Log.d(TAG, &quot;requestMultiPermissions permissionsList:&quot; + permissionsList.size() + &quot;,shouldRationalePermissionsList:&quot; + shouldRationalePermissionsList.size());

        if (permissionsList.size() &gt; 0) {
            ActivityCompat.requestPermissions(activity, permissionsList.toArray(new String[permissionsList.size()]),
                    CODE_MULTI_PERMISSION);
            Log.d(TAG, &quot;showMessageOKCancel requestPermissions&quot;);

        } else if (shouldRationalePermissionsList.size() &gt; 0) {
            showMessageOKCancel(activity, &quot;should open those permission&quot;,
                    new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
                            ActivityCompat.requestPermissions(activity, shouldRationalePermissionsList.toArray(new String[shouldRationalePermissionsList.size()]),
                                    CODE_MULTI_PERMISSION);
                            Log.d(TAG, &quot;showMessageOKCancel requestPermissions&quot;);
                        }
                    });
        } else {
            grant.onPermissionGranted(CODE_MULTI_PERMISSION);
        }

    }


    private static void shouldShowRationale(final Activity activity, final int requestCode, final String requestPermission) {
        //TODO
        String[] permissionsHint = activity.getResources().getStringArray(R.array.permissions);
        showMessageOKCancel(activity, &quot;Rationale: &quot; + permissionsHint[requestCode], new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                ActivityCompat.requestPermissions(activity,
                        new String[]{requestPermission},
                        requestCode);
                Log.d(TAG, &quot;showMessageOKCancel requestPermissions:&quot; + requestPermission);
            }
        });
    }

    private static void showMessageOKCancel(final Activity context, String message, DialogInterface.OnClickListener okListener) {
        new AlertDialog.Builder(context)
                .setMessage(message)
                .setPositiveButton(&quot;OK&quot;, okListener)
                .setNegativeButton(&quot;Cancel&quot;, null)
                .create()
                .show();

    }

    /**
     * @param activity
     * @param requestCode  Need consistent with requestPermission
     * @param permissions
     * @param grantResults
     */
    public static void requestPermissionsResult(final Activity activity, final int requestCode, @NonNull String[] permissions,
                                                @NonNull int[] grantResults, PermissionGrant permissionGrant) {

        if (activity == null) {
            return;
        }
        Log.d(TAG, &quot;requestPermissionsResult requestCode:&quot; + requestCode);

        if (requestCode == CODE_MULTI_PERMISSION) {
            requestMultiResult(activity, permissions, grantResults, permissionGrant);
            return;
        }

        if (requestCode &lt; 0 || requestCode &gt;= requestPermissions.length) {
            Log.w(TAG, &quot;requestPermissionsResult illegal requestCode:&quot; + requestCode);
            Toast.makeText(activity, &quot;illegal requestCode:&quot; + requestCode, Toast.LENGTH_SHORT).show();
            return;
        }

        Log.i(TAG, &quot;onRequestPermissionsResult requestCode:&quot; + requestCode + &quot;,permissions:&quot; + permissions.toString()
                + &quot;,grantResults:&quot; + grantResults.toString() + &quot;,length:&quot; + grantResults.length);

        if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
            Log.i(TAG, &quot;onRequestPermissionsResult PERMISSION_GRANTED&quot;);
            //TODO success, do something, can use callback
            permissionGrant.onPermissionGranted(requestCode);

        } else {
            //TODO hint user this permission function
            Log.i(TAG, &quot;onRequestPermissionsResult PERMISSION NOT GRANTED&quot;);
            //TODO
            String[] permissionsHint = activity.getResources().getStringArray(R.array.permissions);
            openSettingActivity(activity,  &quot;Result&quot; + permissionsHint[requestCode]);
        }

    }

    private static void openSettingActivity(final Activity activity, String message) {

        showMessageOKCancel(activity, message, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                Intent intent = new Intent();
                intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
                Log.d(TAG, &quot;getPackageName(): &quot; + activity.getPackageName());
                Uri uri = Uri.fromParts(&quot;package&quot;, activity.getPackageName(), null);
                intent.setData(uri);
                activity.startActivity(intent);
            }
        });
    }


    /**
     * @param activity
     * @param isShouldRationale true: return no granted and shouldShowRequestPermissionRationale permissions, false:return no granted and !shouldShowRequestPermissionRationale
     * @return
     */
    public static ArrayList&lt;String&gt; getNoGrantedPermission(Activity activity, boolean isShouldRationale) {

        ArrayList&lt;String&gt; permissions = new ArrayList&lt;&gt;();

        for (int i = 0; i &lt; requestPermissions.length; i++) {
            String requestPermission = requestPermissions[i];


            //TODO checkSelfPermission
            int checkSelfPermission = -1;
            try {
                checkSelfPermission = ActivityCompat.checkSelfPermission(activity, requestPermission);
            } catch (RuntimeException e) {
                Toast.makeText(activity, &quot;please open those permission&quot;, Toast.LENGTH_SHORT)
                        .show();
                Log.e(TAG, &quot;RuntimeException:&quot; + e.getMessage());
                return null;
            }

            if (checkSelfPermission != PackageManager.PERMISSION_GRANTED) {
                Log.i(TAG, &quot;getNoGrantedPermission ActivityCompat.checkSelfPermission != PackageManager.PERMISSION_GRANTED:&quot; + requestPermission);

                if (ActivityCompat.shouldShowRequestPermissionRationale(activity, requestPermission)) {
                    Log.d(TAG, &quot;shouldShowRequestPermissionRationale if&quot;);
                    if (isShouldRationale) {
                        permissions.add(requestPermission);
                    }

                } else {

                    if (!isShouldRationale) {
                        permissions.add(requestPermission);
                    }
                    Log.d(TAG, &quot;shouldShowRequestPermissionRationale else&quot;);
                }

            }
        }

        return permissions;
    }

}
</code></pre><h2 id="界面调用代码"><a href="#界面调用代码" class="headerlink" title="界面调用代码"></a>界面调用代码</h2><pre><code>package com.example.android.system.runtimepermissions;

import android.os.Bundle;
import android.support.annotation.NonNull;
import android.support.v4.app.ActivityCompat;
import android.support.v4.app.FragmentActivity;
import android.support.v4.app.FragmentTransaction;
import android.view.View;
import android.widget.Toast;

import com.example.android.common.logger.Log;

/**
 * Created by qianxiaoai on 2016/7/8.
 */
public class PermissionActivity extends FragmentActivity implements ActivityCompat.OnRequestPermissionsResultCallback{
    private static final String TAG = PermissionActivity.class.getSimpleName();

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_permission);
        FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();
        PermissionsFragment fragment = new PermissionsFragment();
        transaction.replace(R.id.content_fragment, fragment);
        transaction.commit();

    }

    /**
     * Called when the &apos;show camera&apos; button is clicked.
     * Callback is defined in resource layout definition.
     */
    public void showCamera(View view) {
        Log.i(TAG, &quot;Show camera button pressed. Checking permission.&quot;);
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_CAMERA, mPermissionGrant);
    }

    public void getAccounts(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_GET_ACCOUNTS, mPermissionGrant);
    }

    public void callPhone(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_CALL_PHONE, mPermissionGrant);
    }

    public void readPhoneState(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_READ_PHONE_STATE, mPermissionGrant);
    }

    public void accessFineLocation(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_ACCESS_FINE_LOCATION, mPermissionGrant);
    }

    public void accessCoarseLocation(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_ACCESS_COARSE_LOCATION, mPermissionGrant);
    }

    public void readExternalStorage(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_READ_EXTERNAL_STORAGE, mPermissionGrant);
    }

    public void writeExternalStorage(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_WRITE_EXTERNAL_STORAGE, mPermissionGrant);
    }

    public void recordAudio(View view) {
        PermissionUtils.requestPermission(this, PermissionUtils.CODE_RECORD_AUDIO, mPermissionGrant);
    }


    private PermissionUtils.PermissionGrant mPermissionGrant = new PermissionUtils.PermissionGrant() {
        @Override
        public void onPermissionGranted(int requestCode) {
            switch (requestCode) {
                case PermissionUtils.CODE_RECORD_AUDIO:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_RECORD_AUDIO&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_GET_ACCOUNTS:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_GET_ACCOUNTS&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_READ_PHONE_STATE:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_READ_PHONE_STATE&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_CALL_PHONE:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_CALL_PHONE&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_CAMERA:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_CAMERA&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_ACCESS_FINE_LOCATION:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_ACCESS_FINE_LOCATION&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_ACCESS_COARSE_LOCATION:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_ACCESS_COARSE_LOCATION&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_READ_EXTERNAL_STORAGE:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_READ_EXTERNAL_STORAGE&quot;, Toast.LENGTH_SHORT).show();
                    break;
                case PermissionUtils.CODE_WRITE_EXTERNAL_STORAGE:
                    Toast.makeText(PermissionActivity.this, &quot;Result Permission Grant CODE_WRITE_EXTERNAL_STORAGE&quot;, Toast.LENGTH_SHORT).show();
                    break;
                default:
                    break;
            }
        }
    };

    /**
     * Callback received when a permissions request has been completed.
     */
    @Override
    public void onRequestPermissionsResult(final int requestCode, @NonNull String[] permissions,
                                           @NonNull int[] grantResults) {
        PermissionUtils.requestPermissionsResult(this, requestCode, permissions, grantResults, mPermissionGrant);
    }
}
</code></pre><h2 id="xml布局"><a href="#xml布局" class="headerlink" title="xml布局"></a>xml布局</h2><pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
              android:layout_width=&quot;match_parent&quot;
              android:layout_height=&quot;match_parent&quot;
              android:paddingLeft=&quot;@dimen/horizontal_page_margin&quot;
              android:paddingRight=&quot;@dimen/horizontal_page_margin&quot;
              android:paddingTop=&quot;@dimen/vertical_page_margin&quot;
              android:paddingBottom=&quot;@dimen/vertical_page_margin&quot;
              android:orientation=&quot;vertical&quot;
    &gt;

    &lt;FrameLayout
        android:id=&quot;@+id/content_fragment&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;0dp&quot;
        android:layout_weight=&quot;1&quot;/&gt;

    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;0dp&quot;
        android:layout_weight=&quot;1&quot;&gt;

        &lt;LinearLayout
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;match_parent&quot;
            android:orientation=&quot;vertical&quot;&gt;

            &lt;LinearLayout
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:orientation=&quot;horizontal&quot;&gt;

                &lt;Button
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    android:text=&quot;Camera&quot;
                    android:id=&quot;@+id/button_camera&quot;
                    android:onClick=&quot;showCamera&quot;/&gt;

                &lt;Button
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    android:text=&quot;RECORD_AUDIO&quot;
                    android:onClick=&quot;recordAudio&quot;/&gt;
            &lt;/LinearLayout&gt;

            &lt;LinearLayout
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:orientation=&quot;horizontal&quot;&gt;

                &lt;Button
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    android:text=&quot;GET_ACCOUNTS&quot;
                    android:onClick=&quot;getAccounts&quot;/&gt;

                &lt;Button
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    android:text=&quot;CALL_PHONE&quot;
                    android:onClick=&quot;callPhone&quot;/&gt;
            &lt;/LinearLayout&gt;

            &lt;Button
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;PERMISSION_READ_PHONE_STATE&quot;
                android:onClick=&quot;readPhoneState&quot;/&gt;

            &lt;Button
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;ACCESS_FINE_LOCATION&quot;
                android:onClick=&quot;accessFineLocation&quot;/&gt;

            &lt;Button
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;ACCESS_COARSE_LOCATION&quot;
                android:onClick=&quot;accessCoarseLocation&quot;/&gt;

            &lt;Button
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;READ_EXTERNAL_STORAGE&quot;
                android:onClick=&quot;readExternalStorage&quot;/&gt;

            &lt;Button
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;WRITE_EXTERNAL_STORAGE&quot;
                android:onClick=&quot;writeExternalStorage&quot;/&gt;

        &lt;/LinearLayout&gt;
    &lt;/ScrollView&gt;

&lt;/LinearLayout&gt;
</code></pre><h2 id="清单文件申请的权限"><a href="#清单文件申请的权限" class="headerlink" title="清单文件申请的权限"></a>清单文件申请的权限</h2><pre><code>&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot;/&gt;

  &lt;uses-permission android:name=&quot;android.permission.GET_ACCOUNTS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot;/&gt;
</code></pre><h2 id="部分-资源文件"><a href="#部分-资源文件" class="headerlink" title="部分 资源文件"></a>部分 资源文件</h2><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
    &lt;string-array name=&quot;permissions&quot;&gt;
        &lt;item&gt;@string/permission_recode_audio_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_get_accounts_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_read_phone_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_call_phone_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_camera_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_access_fine_location_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_access_coarse_location_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_read_external_hint&lt;/item&gt;
        &lt;item&gt;@string/permission_white_external_hint&lt;/item&gt;
    &lt;/string-array&gt;
&lt;/resources&gt;

 &lt;string name=&quot;permission_get_accounts_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_GET_ACCOUNTS&lt;/string&gt;
    &lt;string name=&quot;permission_read_phone_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_READ_PHONE_STATE&lt;/string&gt;
    &lt;string name=&quot;permission_call_phone_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_CALL_PHONE&lt;/string&gt;
    &lt;string name=&quot;permission_camera_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_CAMERA&lt;/string&gt;
    &lt;string name=&quot;permission_access_fine_location_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_ACCESS_FINE_LOCATION&lt;/string&gt;
    &lt;string name=&quot;permission_access_coarse_location_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_ACCESS_COARSE_LOCATION&lt;/string&gt;
    &lt;string name=&quot;permission_read_external_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_READ_EXTERNAL_STORAGE&lt;/string&gt;
    &lt;string name=&quot;permission_white_external_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_WRITE_EXTERNAL_STORAGE&lt;/string&gt;
    &lt;string name=&quot;permission_recode_audio_hint&quot;&gt;没有此权限，无法开启这个功能，请开启权限。PERMISSION_RECORD_AUDIO&lt;/string&gt;
</code></pre>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/07/25/动态权限申请/">Android6.0动态权限申请步骤以及需要注意的一些坑</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">小爱小世界</a></p>
        <p><span>发布时间:</span>2016-07-25, 14:51:12</p>
        <p><span>最后更新:</span>2016-09-09, 16:02:11</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/07/25/动态权限申请/" title="Android6.0动态权限申请步骤以及需要注意的一些坑">http://lovexiaoai.cn/2016/07/25/动态权限申请/</a>
            <span class="copy-path" data-clipboard-text="原文: http://lovexiaoai.cn/2016/07/25/动态权限申请/　　作者: 小爱小世界" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/09/09/面试总结-Java基础(一)/">
                    面试总结-Java基础(一)
                </a>
            </div>
        
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本介绍"><span class="toc-number">1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#申请步骤"><span class="toc-number">2.</span> <span class="toc-text">申请步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#备注！！！"><span class="toc-number">3.</span> <span class="toc-text">备注！！！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一次申请多个权限"><span class="toc-number">4.</span> <span class="toc-text">一次申请多个权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#整个申请权限工具类代码"><span class="toc-number">5.</span> <span class="toc-text">整个申请权限工具类代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#界面调用代码"><span class="toc-number">6.</span> <span class="toc-text">界面调用代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml布局"><span class="toc-number">7.</span> <span class="toc-text">xml布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#清单文件申请的权限"><span class="toc-number">8.</span> <span class="toc-text">清单文件申请的权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部分-资源文件"><span class="toc-number">9.</span> <span class="toc-text">部分 资源文件</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Android6.0动态权限申请步骤以及需要注意的一些坑　| 小爱　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/07/25/动态权限申请/" data-title="Android6.0动态权限申请步骤以及需要注意的一些坑" data-url="http://lovexiaoai.cn/2016/07/25/动态权限申请/"></div>
    <script>
        var duoshuoQuery = {short_name:"lovexiaoai"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/09/09/面试总结-Java基础(一)/" title="上一篇: 面试总结-Java基础(一)">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/手工/">手工制作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/Android7.0须知--应用间共享文件/">Android7.0须知--应用间共享文件（FileProvider）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/面试总结-Java基础(一)/">面试总结-Java基础(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/25/动态权限申请/">Android6.0动态权限申请步骤以及需要注意的一些坑</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 小爱小世界
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
             post: ".article-entry a[href], .copyright a[href]", 
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>